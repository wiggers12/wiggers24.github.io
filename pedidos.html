<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comanda Digital - Pedidos</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; font-family:'Poppins',sans-serif; background:#0d0d0d; color:white; text-align:center; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; font-size:22px; font-weight:700; }
    select, input { margin:10px; padding:10px; border-radius:6px; border:none; background:#2c2c2c; color:white; }
    .btn { margin:20px auto; padding:12px; border:none; border-radius:8px; font-weight:600; cursor:pointer; background:#8e44ad; color:#fff; }
    .btn:hover { background:#b8860b; }
    .pedido { padding:10px; margin:5px auto; background:#1a1a1a; border-radius:6px; }
  </style>
</head>
<body>
<header>üçî Lan√ßar Pedidos</header>

<div>
  <label>Mesa:</label>
  <select id="mesaSelect"></select>
  <br>
  <label>Produto:</label>
  <select id="produtoSelect"></select>
  <br>
  <label>Valor (R$):</label>
  <input type="number" id="valor">
  <button class="btn" onclick="adicionarPedido()">‚ûï Adicionar Pedido</button>
</div>

<h3>Pedidos Registrados</h3>
<div id="listaPedidos"></div>

<script>
let dados = JSON.parse(localStorage.getItem("comandaDigital")) || {mesas:[], pedidos:[], vendas:[], financeiro:{entradas:0,saidas:0,saldo:0}, estoque:[]};
function salvar(){ localStorage.setItem("comandaDigital", JSON.stringify(dados)); }

// Atualizar mesas abertas
function atualizarMesas(){
  let sel=document.getElementById("mesaSelect");
  sel.innerHTML="";
  dados.mesas.filter(m=>m.status==="aberta").forEach(m=>{
    let opt=document.createElement("option");
    opt.value=m.id;
    opt.textContent="Mesa "+m.id;
    sel.appendChild(opt);
  });
}

// Atualizar produtos do estoque
function atualizarProdutos(){
  let sel=document.getElementById("produtoSelect");
  sel.innerHTML="";
  dados.estoque.forEach(p=>{
    let opt=document.createElement("option");
    opt.value=p.nome;
    opt.textContent=`${p.nome} (R$ ${p.valor}) - ${p.qtd>0?p.qtd+" un":"servi√ßo"}`;
    sel.appendChild(opt);
  });
}

// Adicionar pedido
function adicionarPedido(){
  let mesa=document.getElementById("mesaSelect").value;
  let produtoNome=document.getElementById("produtoSelect").value;
  let valor=parseFloat(document.getElementById("valor").value)||0;

  if(!mesa || !produtoNome){ alert("Selecione mesa e produto!"); return; }

  let produto=dados.estoque.find(e=>e.nome===produtoNome);

  // Se n√£o informado valor, usar do estoque
  if(!valor && produto){ valor=produto.valor; }

  // Baixar do estoque se for produto f√≠sico
  if(produto && produto.qtd>0){
    if(produto.qtd>0){ 
      produto.qtd--; 
    } else { 
      alert("‚ùå Estoque insuficiente!"); 
      return; 
    }
  }

  // Registrar pedido
  dados.pedidos.push({mesa, produto:produtoNome, valor, data:new Date().toLocaleDateString()});
  salvar();
  listarPedidos();
  atualizarProdutos();

  document.getElementById("valor").value="";
}

function listarPedidos(){
  let div=document.getElementById("listaPedidos");
  div.innerHTML="";
  dados.pedidos.forEach(p=>{
    let el=document.createElement("div");
    el.className="pedido";
    el.innerText=`Mesa ${p.mesa} - ${p.produto} - R$ ${p.valor}`;
    div.appendChild(el);
  });
}

atualizarMesas();
atualizarProdutos();
listarPedidos();
</script>
</body>
</html>